<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Pessoas - Zeferini</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div class="app-shell">
        <!-- Navbar -->
        <nav class="app-shell__navbar">
            <div class="navbar-content">
                <button class="navbar-burger" onclick="toggleDrawer()" title="Menu">
                    <span class="material-symbols-rounded">menu</span>
                </button>
                <div class="navbar-title">Zeferini</div>
                <div class="navbar-spacer"></div>
            </div>
        </nav>

        <!-- Sidenav Drawer -->
        <nav class="app-shell__drawer" id="drawer">
            <div class="sidenav-header">
                <h2>Zeferini</h2>
                <button class="sidenav-close" onclick="closeDrawer()" title="Fechar menu">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>

            <div class="sidenav-content">
                <!-- Principal Section -->
                <div class="sidenav-section">
                    <h3 class="sidenav-section-title">Principal</h3>
                    <a href="#" class="sidenav-item" th:href="@{/persons}" onclick="closeDrawer()">
                        <span class="material-symbols-rounded">people</span>
                        <span>Pessoas</span>
                    </a>
                </div>

                <!-- APIs Section -->
                <div class="sidenav-section">
                    <h3 class="sidenav-section-title">APIs</h3>
                    <a href="http://localhost:3000/api" target="_blank" rel="noopener noreferrer" class="sidenav-item">
                        <span class="material-symbols-rounded">api</span>
                        <span>Command (3000)</span>
                        <span class="material-symbols-rounded external-icon">open_in_new</span>
                    </a>
                    <a href="http://localhost:3001/api" target="_blank" rel="noopener noreferrer" class="sidenav-item">
                        <span class="material-symbols-rounded">api</span>
                        <span>Query (3001)</span>
                        <span class="material-symbols-rounded external-icon">open_in_new</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Backdrop -->
        <div class="app-shell__backdrop" id="backdrop" onclick="closeDrawer()"></div>

        <!-- Main Content -->
        <main class="app-shell__content">
            <!-- Success Message -->
            <div th:if="${success} or ${param.success}" class="snackbar success-message" id="successMessage">
                Operação realizada com sucesso!
            </div>
            <!-- Error Message -->
            <div th:if="${error} or ${param.error}" class="snackbar error-message" id="errorMessage">
                Erro ao executar operação. Tente novamente.
            </div>

            <div class="container">
                <div class="page-header">
                    <h1>Pessoas</h1>
                    <a th:href="@{/persons/new}" class="btn btn-primary">
                        <span class="material-symbols-rounded">add</span>
                        Adicionar Pessoa
                    </a>
                </div>

                <div th:if="${#lists.isEmpty(persons)}" class="empty-state">
                    <span class="material-symbols-rounded">people</span>
                    <h2>Nenhuma pessoa cadastrada</h2>
                    <p>Clique no botão acima para adicionar sua primeira pessoa</p>
                </div>

                <div th:if="${!#lists.isEmpty(persons)}" class="card">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Criado em</th>
                                <th width="120">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="person : ${persons}">
                                <td th:text="${person.name}">Nome</td>
                                <td th:text="${person.email}">Email</td>
                                <td th:text="${person.formattedCreatedAt}" class="text-muted">Data</td>
                                <td>
                                    <a th:href="@{/persons/{id}/edit(id=${person.id})}" class="btn-icon" title="Editar">
                                        <span class="material-symbols-rounded">edit</span>
                                    </a>
                                    <button class="btn-icon" onclick="showDeleteConfirm(this)" 
                                            th:data-id="${person.id}"
                                            th:data-name="${person.name}"
                                            title="Deletar">
                                        <span class="material-symbols-rounded">delete</span>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Delete Confirmation Dialog -->
            <div class="dialog-overlay" id="deleteDialog" onclick="if(event.target === this) closeDeleteDialog()">
                <div class="dialog">
                    <h2>Confirmar exclusão</h2>
                    <p id="deleteMessage">Tem certeza que deseja deletar <strong id="deletePersonName"></strong>?</p>
                    <div class="dialog-actions">
                        <button class="btn btn-secondary" onclick="closeDeleteDialog()">Cancelar</button>
                        <form id="deleteForm" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-danger">Deletar</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script th:inline="javascript">
        function toggleDrawer() {
            const drawer = document.getElementById('drawer');
            const backdrop = document.getElementById('backdrop');
            const isOpen = drawer.classList.contains('app-shell__drawer--open');

            if (isOpen) {
                closeDrawer();
            } else {
                drawer.classList.add('app-shell__drawer--open');
                backdrop.classList.add('visible');
            }
        }

        function closeDrawer() {
            const drawer = document.getElementById('drawer');
            const backdrop = document.getElementById('backdrop');
            drawer.classList.remove('app-shell__drawer--open');
            backdrop.classList.remove('visible');
        }

        function showDeleteConfirm(button) {
            const id = button.getAttribute('data-id');
            const name = button.getAttribute('data-name');
            const form = document.getElementById('deleteForm');

            form.action = '/persons/' + id + '/delete';
            document.getElementById('deletePersonName').textContent = name;
            document.getElementById('deleteDialog').style.display = 'flex';
        }

        function closeDeleteDialog() {
            document.getElementById('deleteDialog').style.display = 'none';
        }

        // Auto-hide messages after 3 seconds
        setTimeout(function() {
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            if (successMsg) successMsg.style.display = 'none';
            if (errorMsg) errorMsg.style.display = 'none';
        }, 3000);
    </script>
</body>
</html>
